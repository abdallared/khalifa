# ๐ฅ Khalifa Pharmacy - Conversation Management System
## ูุธุงู ุฅุฏุงุฑุฉ ูุญุงุฏุซุงุช ุตูุฏููุงุช ุฎูููุฉ

<div align="center">

![Django](https://img.shields.io/badge/Django-4.2.7-green?style=for-the-badge&logo=django)
![Python](https://img.shields.io/badge/Python-3.10+-blue?style=for-the-badge&logo=python)
![WhatsApp](https://img.shields.io/badge/WhatsApp-Integration-25D366?style=for-the-badge&logo=whatsapp)
![License](https://img.shields.io/badge/License-Private-red?style=for-the-badge)

**ูุธุงู ูุชูุงูู ูุฅุฏุงุฑุฉ ูุญุงุฏุซุงุช ุงูุนููุงุก ุนุจุฑ WhatsApp ูุน ุชุชุจุน ุงูุฃุฏุงุก ูุงูุชุญูููุงุช**

</div>

---

## ๐จโ๐ป ุงููุทูุฑ

**ูุญูุฏ ูุงุฑุณ** - AI Software Engineer  
ูููุฏุณ ุจุฑูุฌูุงุช ูุชุฎุตุต ูู ุชุทููุฑ ุชุทุจููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุชูุงููุงุช ููุตุงุช ุงูุชูุงุตู ุงูุงุฌุชูุงุนู

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุฅุฏุงุฑุฉ ูุญุงุฏุซุงุช ุตูุฏููุงุช ุฎูููุฉ ูู ููุตุฉ ุดุงููุฉ ูุฅุฏุงุฑุฉ ุชูุงุนูุงุช ุงูุนููุงุก ุนุจุฑ WhatsAppุ ูุน ููุฒุงุช ูุชูุฏูุฉ ูุชุชุจุน ุงูุฃุฏุงุกุ ุฅุฏุงุฑุฉ ุงูุชุฐุงูุฑุ ูุงูุชุญูููุงุช ูู ุงูููุช ุงููุนูู.

### โจ ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

#### ๐ฏ ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช
- โ ุฑุจุท ูุจุงุดุฑ ูุน WhatsApp ุนุจุฑ WPPConnect
- โ ุฅุฏุงุฑุฉ ุงูุชุฐุงูุฑ (Tickets) ุจูุธุงู ุฐูู
- โ ุชูุฒูุน ุชููุงุฆู ููุชุฐุงูุฑ ุนูู ุงูููุธููู
- โ ุฏุนู ุงูุฑุณุงุฆู ุงููุตูุฉ ูุงูุตูุฑ ูุงููููุงุช
- โ ููุงูุจ ุฑุณุงุฆู ุฌุงูุฒุฉ (Templates)
- โ ุฑุฏูุฏ ุชููุงุฆูุฉ (Auto-Reply)

#### ๐ฅ ุฅุฏุงุฑุฉ ุงูููุธููู
- โ ูุธุงู ุตูุงุญูุงุช ูุชุนุฏุฏ ุงููุณุชููุงุช (Admin, Agent, QA, Supervisor, Manager)
- โ ุชุชุจุน ุญุงูุฉ ุงูููุธููู (Online/Offline/Break)
- โ ุฅุฏุงุฑุฉ ุงูุณุนุฉ ุงููุตูู ููู ููุธู
- โ ููู ุงูุชุฐุงูุฑ ุจูู ุงูููุธููู
- โ ุชุชุจุน ููุช ุงูุงุณุชุฑุงุญุฉ

#### ๐ ุงูุชุญูููุงุช ูุงูุชูุงุฑูุฑ
- โ ูุคุดุฑุงุช ุงูุฃุฏุงุก (KPIs) ูู ุงูููุช ุงููุนูู
- โ ุชูุงุฑูุฑ ููููุฉ ูุดูุฑูุฉ
- โ ุชุชุจุน ููุช ุงูุงุณุชุฌุงุจุฉ
- โ ูุนุฏู ุญู ุงููุดููุงุช
- โ ุฑุถุง ุงูุนููุงุก
- โ ุชุญููู ุงูุชุฃุฎูุฑุงุช

#### ๐ ุงูุฅุดุนุงุฑุงุช ูุงูุชูุจููุงุช
- โ ุชูุจููุงุช ุงูุชุฃุฎูุฑ ูู ุงูุฑุฏ
- โ ุฅุดุนุงุฑุงุช ุงูุชุฐุงูุฑ ุงูุฌุฏูุฏุฉ
- โ ุชูุจููุงุช ุงูุณุนุฉ ุงููุตูู
- โ ุฅุดุนุงุฑุงุช ููู ุงูุชุฐุงูุฑ

#### ๐ก๏ธ ุงูุฃูุงู ูุงูุญูุงูุฉ
- โ ูุธุงู ูุตุงุฏูุฉ ุขูู
- โ ุญูุงูุฉ ูู ูุฌูุงุช Brute Force
- โ ุชุดููุฑ ูููุงุช ุงููุฑูุฑ
- โ ุณุฌู ุงููุดุงุทุงุช (Activity Log)
- โ ุฌูุณุงุช ุฏุงุฆูุฉ ุขููุฉ

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### Backend
- **Framework:** Django 4.2.7
- **API:** Django REST Framework 3.14.0
- **Database:** SQLite (Development) / PostgreSQL (Production)
- **Authentication:** Session-based + Custom Backend

### WhatsApp Integration
- **Driver:** WPPConnect
- **Features:** Send/Receive Messages, Media Support, QR Code Authentication

### Frontend
- **Technology:** HTML5, CSS3, JavaScript (Vanilla)
- **Design:** Modern, Responsive, RTL Support
- **Icons:** Custom SVG Icons
- **Theme:** Dark Mode (Sophos XG Inspired)

---

## ๐ฆ ุงูุชุซุจูุช

### ุงููุชุทูุจุงุช
- Python 3.10+
- Node.js 16+
- npm

### ุงูุชุซุจูุช ุงูุณุฑูุน

```bash
# 1. Clone ุงููุดุฑูุน
git clone [repository-url]
cd khalifa

# 2. ุฅูุดุงุก ูุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
python -m venv venv
venv\Scripts\activate  # Windows
# source venv/bin/activate  # Linux/Mac

# 3. ุชุซุจูุช ุงูููุชุจุงุช
pip install -r requirements.txt

# 4. ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
cd System
python manage.py migrate

# 5. ุชุดุบูู WPPConnect
cd ..\wppconnect-server
npm install
npm start

# 6. ุชุดุบูู Django
cd ..\System
python manage.py runserver 0.0.0.0:8888
```

๐ **ูููุฒูุฏ ูู ุงูุชูุงุตูู:** ุฑุงุฌุน [INSTALLATION.md](INSTALLATION.md)

---

## ๐ ุงูุงุณุชุฎุฏุงู

### ุชุดุบูู ุงููุดุฑูุน

#### Windows:
```bash
# ุชุดุบูู ูู ุดูุก
START_SERVERS.bat

# ุฃู ููุชุทููุฑ
dev.bat
```

#### Linux/Mac:
```bash
# ุชุดุบูู Django
python System/manage.py runserver 0.0.0.0:8888

# ุชุดุบูู WPPConnect (ูู terminal ุขุฎุฑ)
cd wppconnect-server && npm start
```

### ุงููุตูู ุฅูู ุงููุธุงู

- **Frontend:** http://localhost:8888
- **API:** http://localhost:8888/api/
- **Admin Panel:** http://localhost:8888/admin/
- **WPPConnect:** http://localhost:3000

### ุงููุณุชุฎุฏู ุงูุงูุชุฑุงุถู

```
Username: admin
Password: admin123
```

---

## ๐ ุงูุจููุฉ ุงููููููุฉ

```
khalifa/
โโโ System/                          # Django Project
โ   โโโ conversations/               # Main App
โ   โ   โโโ models.py               # 22 Database Models
โ   โ   โโโ views.py                # API Endpoints
โ   โ   โโโ serializers.py          # DRF Serializers
โ   โ   โโโ utils.py                # Utility Functions
โ   โ   โโโ whatsapp_driver.py      # WhatsApp Integration
โ   โ   โโโ message_queue.py        # Message Queue Manager
โ   โ   โโโ middleware.py           # Custom Middleware
โ   โ   โโโ permissions.py          # Custom Permissions
โ   โ   โโโ management/             # Django Commands
โ   โโโ khalifa_pharmacy/           # Project Settings
โ   โ   โโโ settings.py             # Configuration
โ   โ   โโโ urls.py                 # URL Routing
โ   โ   โโโ wsgi.py                 # WSGI Config
โ   โโโ static/                     # Static Files
โ   โโโ media/                      # Uploaded Media
โ   โโโ templates/                  # HTML Templates
โ   โโโ logs/                       # Log Files
โ   โโโ db.sqlite3                  # Database
โโโ wppconnect-server/              # WhatsApp Server
โโโ requirements.txt                # Python Dependencies
โโโ requirements-dev.txt            # Development Dependencies
โโโ requirements-prod.txt           # Production Dependencies
โโโ README.md                       # This File
โโโ INSTALLATION.md                 # Installation Guide
โโโ .env                            # Environment Variables
```

---

## ๐๏ธ ููุงุฐุฌ ูุงุนุฏุฉ ุงูุจูุงูุงุช (22 Model)

### 1. User Management (3 Models)
- `User` - ุงููุณุชุฎุฏููู
- `Agent` - ุงูููุธููู
- `Admin` - ุงููุฏูุฑูู

### 2. Customer Management (3 Models)
- `Customer` - ุงูุนููุงุก
- `CustomerTag` - ุชุตูููุงุช ุงูุนููุงุก
- `CustomerNote` - ููุงุญุธุงุช ุงูุนููุงุก

### 3. Ticket Management (3 Models)
- `Ticket` - ุงูุชุฐุงูุฑ
- `TicketTransferLog` - ุณุฌู ููู ุงูุชุฐุงูุฑ
- `TicketStateLog` - ุณุฌู ุชุบููุฑุงุช ุงูุญุงูุฉ

### 4. Messages (3 Models)
- `Message` - ุงูุฑุณุงุฆู
- `MessageDeliveryLog` - ุณุฌู ุงูุชูุตูู
- `MessageSearchIndex` - ููุฑุณ ุงูุจุญุซ

### 5. Templates (3 Models)
- `GlobalTemplate` - ุงูููุงูุจ ุงูุนุงูุฉ
- `AgentTemplate` - ููุงูุจ ุงูููุธููู
- `AutoReplyTrigger` - ูุญูุฒุงุช ุงูุฑุฏ ุงูุชููุงุฆู

### 6. Delay Tracking (3 Models)
- `ResponseTimeTracking` - ุชุชุจุน ููุช ุงูุงุณุชุฌุงุจุฉ
- `AgentDelayEvent` - ุฃุญุฏุงุซ ุงูุชุฃุฎูุฑ
- `AgentBreakSession` - ุฌูุณุงุช ุงูุงุณุชุฑุงุญุฉ

### 7. KPI & Performance (3 Models)
- `AgentKPI` - ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูููููุฉ
- `AgentKPIMonthly` - ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุดูุฑูุฉ
- `CustomerSatisfaction` - ุฑุถุง ุงูุนููุงุก

### 8. System (3 Models)
- `ActivityLog` - ุณุฌู ุงููุดุงุทุงุช
- `LoginAttempt` - ูุญุงููุงุช ุชุณุฌูู ุงูุฏุฎูู
- `SystemSettings` - ุฅุนุฏุงุฏุงุช ุงููุธุงู

---

## ๐ API Endpoints

### Authentication
```
POST   /api/auth/login/              # ุชุณุฌูู ุงูุฏุฎูู
POST   /api/auth/logout/             # ุชุณุฌูู ุงูุฎุฑูุฌ
GET    /api/auth/profile/            # ุงูููู ุงูุดุฎุตู
```

### Tickets
```
GET    /api/tickets/                 # ูุงุฆูุฉ ุงูุชุฐุงูุฑ
POST   /api/tickets/                 # ุฅูุดุงุก ุชุฐูุฑุฉ
GET    /api/tickets/{id}/            # ุชูุงุตูู ุชุฐูุฑุฉ
PATCH  /api/tickets/{id}/            # ุชุญุฏูุซ ุชุฐูุฑุฉ
POST   /api/tickets/{id}/close/      # ุฅุบูุงู ุชุฐูุฑุฉ
POST   /api/tickets/{id}/transfer/   # ููู ุชุฐูุฑุฉ
```

### Messages
```
GET    /api/messages/                # ูุงุฆูุฉ ุงูุฑุณุงุฆู
POST   /api/messages/                # ุฅุฑุณุงู ุฑุณุงูุฉ
GET    /api/tickets/{id}/messages/   # ุฑุณุงุฆู ุชุฐูุฑุฉ ูุนููุฉ
```

### Agents
```
GET    /api/agents/                  # ูุงุฆูุฉ ุงูููุธููู
POST   /api/agents/create_with_user/ # ุฅูุดุงุก ููุธู
GET    /api/agents/available/        # ุงูููุธููู ุงููุชุงุญูู
GET    /api/agents/me/               # ุจูุงูุงุช ุงูููุธู ุงูุญุงูู
POST   /api/agents/{id}/take_break/  # ุจุฏุก ุงุณุชุฑุงุญุฉ
POST   /api/agents/{id}/end_break/   # ุฅููุงุก ุงุณุชุฑุงุญุฉ
```

### Analytics
```
GET    /api/analytics/dashboard/     # ููุญุฉ ุงูุชุญูู
GET    /api/analytics/agent-kpi/     # KPI ุงูููุธููู
GET    /api/analytics/tickets-stats/ # ุฅุญุตุงุฆูุงุช ุงูุชุฐุงูุฑ
```

---

## ๐๏ธ Django Management Commands

```bash
# ุชุญุฏูุซ ูุคุดุฑุงุช ุงูุฃุฏุงุก
python manage.py update_kpis

# ูุนุงูุฌุฉ ูุงุฆูุฉ ุงูุฑุณุงุฆู
python manage.py process_message_queue

# ุชุญุฏูุซ ุงูุชุฐุงูุฑ ุงููุชุฃุฎุฑุฉ
python manage.py update_delayed_tickets

# ุชุญุฏูุซ ุนุฏุฏ ุงูุชุฐุงูุฑ ุงููุดุทุฉ
python manage.py update_active_tickets

# ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงูููุธููู
python manage.py reset_online_status

# ุชุญุฏูุซ ุฌููุน ุงูุฅุญุตุงุฆูุงุช
python manage.py update_all_stats
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

```bash
# ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช
pytest

# ุงุฎุชุจุงุฑ ูุน ุชุบุทูุฉ ุงูููุฏ
pytest --cov=conversations

# ุงุฎุชุจุงุฑ ููู ูุนูู
pytest System/test_agent_break.py
```

---

## ๐ ุงูุฃุฏุงุก ูุงูุชุญุณูู

### Database Optimization
- โ Database Indexes ุนูู ุงูุญููู ุงูุฃูุซุฑ ุงุณุชุฎุฏุงูุงู
- โ `select_related()` ู `prefetch_related()` ููุงุณุชุนูุงูุงุช
- โ Connection Pooling

### Caching
- โ Django Cache Framework
- โ Redis ููู Session Storage (Production)

### Queue Management
- โ Message Queue ูุน Deduplication
- โ Rate Limiting
- โ Retry Mechanism ูุน Exponential Backoff

---

## ๐ ุงูุฃูุงู

### Best Practices
- โ CSRF Protection
- โ SQL Injection Prevention (Django ORM)
- โ XSS Protection
- โ Password Hashing (Django's make_password)
- โ Brute Force Protection (5 attempts โ 15 min lockout)
- โ Session Security (HttpOnly, SameSite)

### Production Security
```python
# ูู settings.py
DEBUG = False
ALLOWED_HOSTS = ['yourdomain.com']
CSRF_COOKIE_SECURE = True
SESSION_COOKIE_SECURE = True
SECURE_SSL_REDIRECT = True
```

---

## ๐ ุงููุณุงููุฉ

ูุฐุง ูุดุฑูุน ุฎุงุต ูุตูุฏููุงุช ุฎูููุฉ. ูููุณุงููุฉ:
1. Fork ุงููุดุฑูุน
2. ุฅูุดุงุก Branch ุฌุฏูุฏ (`git checkout -b feature/AmazingFeature`)
3. Commit ุงูุชุบููุฑุงุช (`git commit -m 'Add some AmazingFeature'`)
4. Push ุฅูู Branch (`git push origin feature/AmazingFeature`)
5. ูุชุญ Pull Request

---

## ๐ ุงูุชุฑุฎูุต

ูุฐุง ุงููุดุฑูุน ุฎุงุต ูููููู ูุตูุฏููุงุช ุฎูููุฉ. ุฌููุน ุงูุญููู ูุญููุธุฉ ยฉ 2025

---

## ๐ ุงูุฏุนู ูุงูุชูุงุตู

**ุงููุทูุฑ:** ูุญูุฏ ูุงุฑุณ  
**ุงูุชุฎุตุต:** AI Software Engineer  
**ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:** [your-email@example.com]

---

## ๐ ุดูุฑ ูุชูุฏูุฑ

- Django Framework
- Django REST Framework
- WPPConnect Team
- ุฌููุน ุงูููุชุจุงุช ููุชูุญุฉ ุงููุตุฏุฑ ุงููุณุชุฎุฏูุฉ

---

## ๐บ๏ธ ุฎุงุฑุทุฉ ุงูุทุฑูู

### ุงููุฑุญูุฉ ุงูุญุงููุฉ โ
- [x] ูุธุงู ุฅุฏุงุฑุฉ ุงููุญุงุฏุซุงุช ุงูุฃุณุงุณู
- [x] ุฑุจุท WhatsApp
- [x] ุฅุฏุงุฑุฉ ุงูุชุฐุงูุฑ
- [x] ูุคุดุฑุงุช ุงูุฃุฏุงุก
- [x] ูุธุงู ุงูุตูุงุญูุงุช

### ุงููุฑุญูุฉ ุงููุงุฏูุฉ ๐
- [ ] WebSocket ููุชุญุฏูุซุงุช ุงูููุฑูุฉ
- [ ] ุชุทุจูู Mobile (React Native)
- [ ] AI Chatbot ููุฑุฏูุฏ ุงูุชููุงุฆูุฉ
- [ ] ุชุญูููุงุช ูุชูุฏูุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
- [ ] ุชูุงูู ูุน ุฃูุธูุฉ ERP

---

<div align="center">

**ุตููุน ุจู โค๏ธ ูู ูุตุฑ**

**ูุญูุฏ ูุงุฑุณ - AI Software Engineer**

</div>
#   k h a l i f a  
 "# khalifa" 
