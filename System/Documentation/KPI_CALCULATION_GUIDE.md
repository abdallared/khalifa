# ๐ ุฏููู ุญุณุงุจ ูุคุดุฑุงุช ุงูุฃุฏุงุก (KPI)

## ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูุฏููู ูุดุฑุญ ุจุงูุชูุตูู ููููุฉ ุญุณุงุจ **ุฃุฏุงุก ุงูููุธููู** ู **ูุชูุณุท ููุช ุงูุฑุฏ** ูู ูุธุงู ุตูุฏููุงุช ุฎูููุฉ.

---

## 1๏ธโฃ ุฃุฏุงุก ุงูููุธููู (Agent Performance)

### ๐ ุงููููุน
- **ุงูุตูุญุฉ:** `http://127.0.0.1:8000/admin/reports/`
- **ุงูููู:** `New folder/templates/admin/reports.html`
- **ุงูุฏุงูุฉ:** `calculate_agent_kpi()` ูู `New folder/conversations/utils.py`

---

### ๐ ุงููุคุดุฑุงุช ุงููุญุณูุจุฉ

#### 1. **ุงูุชุฐุงูุฑ ุงููุนุงูุฌุฉ** (Total Tickets)
```python
# ุงูุณุทุฑ 167-172 ูู utils.py
tickets = Ticket.objects.filter(
    assigned_agent=agent,
    created_at__date=date
)
total_tickets = tickets.count()
```

**ุงูุดุฑุญ:**
- ูุญุณุจ ุนุฏุฏ ุงูุชุฐุงูุฑ ุงูุชู **ุฃููุดุฆุช** ูู ุงูููู ุงููุญุฏุฏ
- ูุชู ุงูููุชุฑุฉ ุญุณุจ `assigned_agent` (ุงูููุธู ุงููุนูู)
- ูุชู ุงูููุชุฑุฉ ุญุณุจ `created_at__date` (ุชุงุฑูุฎ ุงูุฅูุดุงุก)

---

#### 2. **ุงูุชุฐุงูุฑ ุงููุบููุฉ** (Closed Tickets)
```python
# ุงูุณุทุฑ 173 ูู utils.py
closed_tickets = tickets.filter(status='closed').count()
```

**ุงูุดุฑุญ:**
- ูู ุงูุชุฐุงูุฑ ุงููุนุงูุฌุฉุ ูู ุชุฐูุฑุฉ ุชู ุฅุบูุงููุงุ
- ุงูููุชุฑุฉ ุญุณุจ `status='closed'`

---

#### 3. **ูุชูุณุท ููุช ุงูุงุณุชุฌุงุจุฉ** (Average Response Time)
```python
# ุงูุณุทุฑ 175-178 ูู utils.py
avg_response_time = tickets.filter(
    response_time_seconds__isnull=False
).aggregate(Avg('response_time_seconds'))['response_time_seconds__avg'] or 0
```

**ุงูุดุฑุญ:**
- ูุญุณุจ ูุชูุณุท ุงูููุช ุจูู **ุงุณุชูุงู ุฑุณุงูุฉ ุงูุนููู** ู **ุฃูู ุฑุฏ ูู ุงูููุธู**
- ุงููุญุฏุฉ: **ุซูุงูู**
- ูุชู ุชุญูููู ูุฏูุงุฆู ูู ุงูุนุฑุถ: `avg_response_time / 60`

**ููู ูุชู ุญุณุงุจ `response_time_seconds`ุ**
```python
# ูู models.py - Ticket Model
response_time_seconds = models.IntegerField(null=True, blank=True)
```

ูุชู ุญุณุงุจู ุนูุฏ:
1. **ุฅูุดุงุก ุงูุชุฐูุฑุฉ:** `created_at` (ููุช ุงุณุชูุงู ุฑุณุงูุฉ ุงูุนููู)
2. **ุฃูู ุฑุฏ ูู ุงูููุธู:** `first_response_at` (ููุช ุฃูู ุฑุณุงูุฉ ูู ุงูููุธู)
3. **ุงูุญุณุงุจ:** `response_time_seconds = (first_response_at - created_at).total_seconds()`

---

#### 4. **ุงูุฑุณุงุฆู ุงููุฑุณูุฉ** (Messages Sent)
```python
# ุงูุณุทุฑ 181-186 ูู utils.py
messages_sent = Message.objects.filter(
    ticket__assigned_agent=agent,
    sender_type='agent',
    sender_id=agent.user.id,
    created_at__date=date
).count()
```

**ุงูุดุฑุญ:**
- ุนุฏุฏ ุงูุฑุณุงุฆู ุงูุชู ุฃุฑุณููุง ุงูููุธู ูู ุงูููู ุงููุญุฏุฏ
- ุงูููุชุฑุฉ:
  - `sender_type='agent'` (ุงููุฑุณู ููุธู)
  - `sender_id=agent.user.id` (ุงููุฑุณู ูู ูุฐุง ุงูููุธู)
  - `created_at__date=date` (ูู ุงูููู ุงููุญุฏุฏ)

---

#### 5. **ูุนุฏู ุงูุฑุถุง** (Customer Satisfaction Score)
```python
# ุงูุณุทุฑ 197-201 ูู utils.py
satisfaction = CustomerSatisfaction.objects.filter(
    agent=agent,
    created_at__date=date
).aggregate(Avg('rating'))['rating__avg'] or 0
```

**ุงูุดุฑุญ:**
- ูุชูุณุท ุชููููุงุช ุงูุนููุงุก ููููุธู ูู ุงูููู ุงููุญุฏุฏ
- ุงููุทุงู: **0-5** (ูุฌูู)
- ูุชู ุชุญูููู ููุณุจุฉ ูุฆููุฉ: `satisfaction * 20`

---

#### 6. **ูุนุฏู ุงูุงุณุชุฌุงุจุฉ ุงูุฃููู** (First Response Rate)
```python
# ุงูุณุทุฑ 204-207 ูู utils.py
first_response_rate = 0
if total_tickets > 0:
    tickets_with_response = tickets.filter(first_response_at__isnull=False).count()
    first_response_rate = (tickets_with_response / total_tickets) * 100
```

**ุงูุดุฑุญ:**
- ูุณุจุฉ ุงูุชุฐุงูุฑ ุงูุชู ุชู ุงูุฑุฏ ุนูููุง ูู ุฅุฌูุงูู ุงูุชุฐุงูุฑ
- **ุงููุนุงุฏูุฉ:** `(ุนุฏุฏ ุงูุชุฐุงูุฑ ุงูููุฌุงุจ ุนูููุง / ุฅุฌูุงูู ุงูุชุฐุงูุฑ) ร 100`
- **ูุซุงู:** ุฅุฐุง ูุงู ูุฏูู 10 ุชุฐุงูุฑ ูุฑุฏูุช ุนูู 8 ูููุง = 80%

---

#### 7. **ูุนุฏู ุงูุญู** (Resolution Rate)
```python
# ุงูุณุทุฑ 209-211 ูู utils.py
resolution_rate = 0
if total_tickets > 0:
    resolution_rate = (closed_tickets / total_tickets) * 100
```

**ุงูุดุฑุญ:**
- ูุณุจุฉ ุงูุชุฐุงูุฑ ุงููุบููุฉ ูู ุฅุฌูุงูู ุงูุชุฐุงูุฑ
- **ุงููุนุงุฏูุฉ:** `(ุงูุชุฐุงูุฑ ุงููุบููุฉ / ุฅุฌูุงูู ุงูุชุฐุงูุฑ) ร 100`
- **ูุซุงู:** ุฅุฐุง ูุงู ูุฏูู 10 ุชุฐุงูุฑ ูุฃุบููุช 6 ูููุง = 60%

---

#### 8. **ุงููุชูุฌุฉ ุงูุฅุฌูุงููุฉ** (Overall KPI Score) โญ
```python
# ุงูุณุทุฑ 213-214 ูู utils.py
overall_kpi_score = (first_response_rate + resolution_rate + (satisfaction * 20)) / 3
```

**ุงูุดุฑุญ:**
- **ุงููุนุงุฏูุฉ:**
  ```
  Overall KPI = (ูุนุฏู ุงูุงุณุชุฌุงุจุฉ ุงูุฃููู + ูุนุฏู ุงูุญู + (ูุนุฏู ุงูุฑุถุง ร 20)) / 3
  ```

- **ูุซุงู:**
  - ูุนุฏู ุงูุงุณุชุฌุงุจุฉ ุงูุฃููู = 80%
  - ูุนุฏู ุงูุญู = 60%
  - ูุนุฏู ุงูุฑุถุง = 4.5 ูุฌูู โ 4.5 ร 20 = 90%
  - **ุงููุชูุฌุฉ:** `(80 + 60 + 90) / 3 = 76.67%`

- **ุงูุชุตููู:**
  - ๐ข **ููุชุงุฒ:** โฅ 80%
  - ๐ก **ุฌูุฏ:** 60% - 79%
  - ๐ด **ูุญุชุงุฌ ุชุญุณูู:** < 60%

---

## 2๏ธโฃ ูุชูุณุท ููุช ุงูุฑุฏ (ุขุฎุฑ 7 ุฃูุงู)

### ๐ ุงููููุน
- **ุงูุตูุญุฉ:** `http://127.0.0.1:8000/admin/reports/`
- **ุงููุณู:** "ูุชูุณุท ููุช ุงูุฑุฏ (ุขุฎุฑ 7 ุฃูุงู)" - Chart
- **ุงูููู:** `New folder/templates/admin/reports.html` (ุงูุณุทุฑ 147-157)

---

### ๐ ููููุฉ ุงูุญุณุงุจ

#### 1. **ุฌูุจ ุงูุจูุงูุงุช ูู API**
```javascript
// ุงูุณุทุฑ 293-316 ูู reports.html
async function loadReportsData() {
    const dateFrom = document.getElementById('dateFrom').value;
    const dateTo = document.getElementById('dateTo').value;

    const response = await fetch(`/api/reports/?type=daily&date_from=${dateFrom}&date_to=${dateTo}`);
    const data = await response.json();
    updateStatistics(data);
}
```

#### 2. **API Endpoint**
```python
# ูู views_analytics.py - ุงูุณุทุฑ 315-343
def _get_daily_report(self, date_from, date_to):
    tickets = Ticket.objects.filter(
        created_at__date__gte=date_from,
        created_at__date__lte=date_to
    )
    
    return {
        'performance': {
            'avg_response_time': tickets.filter(
                response_time_seconds__isnull=False
            ).aggregate(Avg('response_time_seconds'))['response_time_seconds__avg'] or 0,
        }
    }
```

**ุงูุดุฑุญ:**
1. ูุฌูุจ ุฌููุน ุงูุชุฐุงูุฑ ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ (ุขุฎุฑ 7 ุฃูุงู)
2. ูุญุณุจ ูุชูุณุท `response_time_seconds` ูุฌููุน ุงูุชุฐุงูุฑ
3. ูุณุชุซูู ุงูุชุฐุงูุฑ ุงูุชู ูู ูุชู ุงูุฑุฏ ุนูููุง (`response_time_seconds__isnull=False`)

#### 3. **ุนุฑุถ ุงูุจูุงูุงุช ูู Chart**
```javascript
// ุงูุณุทุฑ 395-437 ูู reports.html
const responseTimeChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],  // ุงูุชูุงุฑูุฎ (ุขุฎุฑ 7 ุฃูุงู)
        datasets: [{
            label: 'ูุชูุณุท ููุช ุงูุฑุฏ (ุฏูููุฉ)',
            data: [],  // ูุชูุณุท ููุช ุงูุฑุฏ ููู ููู
            borderColor: 'rgba(13, 110, 253, 1)',
            backgroundColor: 'rgba(13, 110, 253, 0.1)',
        }]
    }
});
```

---

## 3๏ธโฃ ุฌุฏูู ุฃุฏุงุก ุงูููุธููู

### ๐ ุงููููุน
- **ุงูุตูุญุฉ:** `http://127.0.0.1:8000/admin/reports/`
- **ุงููุณู:** "ุฃุฏุงุก ุงูููุธููู" - Table
- **ุงูููู:** `New folder/templates/admin/reports.html` (ุงูุณุทุฑ 159-230)

### ๐ ุงูุฃุนูุฏุฉ

| ุงูุนููุฏ | ุงููุตุฏุฑ | ุงููุญุฏุฉ |
|--------|--------|--------|
| **ุงูููุธู** | `kpi.agent.user.full_name` | ูุต |
| **ุงูุชุฐุงูุฑ ุงููุนุงูุฌุฉ** | `kpi.total_tickets` | ุนุฏุฏ |
| **ุงูุชุฐุงูุฑ ุงููุบููุฉ** | `kpi.closed_tickets` | ุนุฏุฏ |
| **ูุชูุณุท ููุช ุงูุฑุฏ** | `kpi.avg_response_time_seconds / 60` | ุฏูููุฉ |
| **ุงูุฑุณุงุฆู ุงููุฑุณูุฉ** | `kpi.messages_sent` | ุนุฏุฏ |
| **ูุนุฏู ุงูุฑุถุง** | `kpi.customer_satisfaction_score` | ูุณุจุฉ ูุฆููุฉ |
| **ุงููุชูุฌุฉ ุงูุฅุฌูุงููุฉ** | `kpi.overall_kpi_score` | ูุณุจุฉ ูุฆููุฉ |

---

## 4๏ธโฃ ูุซุงู ุนููู

### ุงูุณููุงุฑูู:
ููุธู ุงุณูู **ูุญูุฏ ุฃุญูุฏ** ูู ููู **2025-11-02**:

#### ุงูุจูุงูุงุช:
- **ุงูุชุฐุงูุฑ ุงููุนุงูุฌุฉ:** 10 ุชุฐุงูุฑ
- **ุงูุชุฐุงูุฑ ุงููุบููุฉ:** 6 ุชุฐุงูุฑ
- **ุงูุชุฐุงูุฑ ุงูููุฌุงุจ ุนูููุง:** 8 ุชุฐุงูุฑ
- **ูุชูุณุท ููุช ุงูุฑุฏ:** 180 ุซุงููุฉ (3 ุฏูุงุฆู)
- **ุงูุฑุณุงุฆู ุงููุฑุณูุฉ:** 25 ุฑุณุงูุฉ
- **ูุนุฏู ุงูุฑุถุง:** 4.5 ูุฌูู

#### ุงูุญุณุงุจุงุช:

1. **ูุนุฏู ุงูุงุณุชุฌุงุจุฉ ุงูุฃููู:**
   ```
   (8 / 10) ร 100 = 80%
   ```

2. **ูุนุฏู ุงูุญู:**
   ```
   (6 / 10) ร 100 = 60%
   ```

3. **ูุนุฏู ุงูุฑุถุง (ูุณุจุฉ ูุฆููุฉ):**
   ```
   4.5 ร 20 = 90%
   ```

4. **ุงููุชูุฌุฉ ุงูุฅุฌูุงููุฉ:**
   ```
   (80 + 60 + 90) / 3 = 76.67%
   ```

#### ุงููุชูุฌุฉ ูู ุงูุฌุฏูู:
| ุงูููุธู | ุงูุชุฐุงูุฑ ุงููุนุงูุฌุฉ | ุงูุชุฐุงูุฑ ุงููุบููุฉ | ูุชูุณุท ููุช ุงูุฑุฏ | ุงูุฑุณุงุฆู ุงููุฑุณูุฉ | ูุนุฏู ุงูุฑุถุง | ุงููุชูุฌุฉ ุงูุฅุฌูุงููุฉ |
|--------|------------------|-----------------|----------------|-----------------|-----------|-------------------|
| ูุญูุฏ ุฃุญูุฏ | 10 | 6 | 3 ุฏูููุฉ | 25 | 90% | 76.7% ๐ก |

---

## 5๏ธโฃ ุงููููุงุช ุฐุงุช ุงูุตูุฉ

### Backend:
1. **`New folder/conversations/utils.py`**
   - ุงูุฏุงูุฉ: `calculate_agent_kpi(agent, date=None)` (ุงูุณุทุฑ 149-235)
   - ุงููุธููุฉ: ุญุณุงุจ ุฌููุน ูุคุดุฑุงุช ุงูุฃุฏุงุก

2. **`New folder/conversations/views_analytics.py`**
   - ุงูุฏุงูุฉ: `_get_daily_report(date_from, date_to)` (ุงูุณุทุฑ 315-343)
   - ุงููุธููุฉ: ุฌูุจ ุชูุฑูุฑ ูููู ูุน ูุชูุณุท ููุช ุงูุฑุฏ

3. **`New folder/conversations/models.py`**
   - Model: `AgentKPI` (ุงูุณุทุฑ 632-660)
   - ุงููุธููุฉ: ุชุฎุฒูู ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูููููุฉ

### Frontend:
1. **`New folder/templates/admin/reports.html`**
   - ุฌุฏูู ุฃุฏุงุก ุงูููุธููู (ุงูุณุทุฑ 159-230)
   - Chart ูุชูุณุท ููุช ุงูุฑุฏ (ุงูุณุทุฑ 147-157)
   - JavaScript ูุชุญููู ุงูุจูุงูุงุช (ุงูุณุทุฑ 293-316)

---

## 6๏ธโฃ ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ

### โ ููุงุฐุง ูุชูุณุท ููุช ุงูุฑุฏ = 0ุ
**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
1. ูุง ุชูุฌุฏ ุชุฐุงูุฑ ุชู ุงูุฑุฏ ุนูููุง ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ
2. ุญูู `response_time_seconds` ูุงุฑุบ (`NULL`)
3. ูู ูุชู ุญุณุงุจ `first_response_at` ุจุดูู ุตุญูุญ

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู ุงูููุธู ุฃุฑุณู ุฑุณุงุฆู
- ุชุญูู ูู ุฃู `first_response_at` ูุชู ุชุญุฏูุซู ุนูุฏ ุฃูู ุฑุณุงูุฉ

---

### โ ููู ูุชู ุชุญุฏูุซ KPI ุชููุงุฆูุงูุ
**ุงูุทุฑููุฉ:**
1. **Django Signals:** ุนูุฏ ุญูุธ ุชุฐูุฑุฉ ุฃู ุฑุณุงูุฉ
2. **Management Command:** `python manage.py update_all_stats`
3. **ูุฏููุงู:** ุงุณุชุฏุนุงุก `calculate_agent_kpi(agent, date)`

---

### โ ูุง ุงููุฑู ุจูู `assigned_agent` ู `current_agent`?
- **`assigned_agent`:** ุงูููุธู ุงูุฐู ุชู ุชุนููู ุงูุชุฐูุฑุฉ ูู ุฃูู ูุฑุฉ
- **`current_agent`:** ุงูููุธู ุงูุฐู ูุชุนุงูู ูุน ุงูุชุฐูุฑุฉ ุญุงููุงู (ูุชุบูุฑ ุนูุฏ ุงูุชุญููู)

**ูู ุญุณุงุจ KPI:** ูุณุชุฎุฏู `assigned_agent` ูุฃูู ููุซู ุงูููุธู ุงููุณุคูู ุนู ุงูุชุฐูุฑุฉ

---

## 7๏ธโฃ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

### ๐ ุงูุชุฑุงุญุงุช:
1. **ุฅุถุงูุฉ ููุชุฑุฉ ุญุณุจ ุงููุชุฑุฉ ุงูุฒูููุฉ** ูู ุตูุญุฉ ุงูุชูุงุฑูุฑ
2. **ุนุฑุถ Chart ููู ููุธู ุนูู ุญุฏุฉ**
3. **ุฅุถุงูุฉ ููุงุฑูุฉ ุจูู ุงูููุธููู**
4. **ุชูุจููุงุช ุนูุฏ ุงูุฎูุงุถ ุงูุฃุฏุงุก**
5. **ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ ุฅูู Excel/PDF**

---

**ุชู ุฅุนุฏุงุฏ ูุฐุง ุงูุฏููู ุจูุงุณุทุฉ:** Augment AI Agent  
**ุงูุชุงุฑูุฎ:** 2025-11-02  
**ุงูุฅุตุฏุงุฑ:** 1.0

