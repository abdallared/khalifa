# ๐ ุชุดุฎูุต ูุฅุตูุงุญ ุฎุทุฃ "ุงูุนูุฏุฉ ููุนูู"

## ๐ ุงููุดููุฉ

ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ "ุงูุนูุฏุฉ ููุนูู"ุ ุชุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ.

---

## ๐ ุฎุทูุงุช ุงูุชุดุฎูุต

### ุงูุฎุทูุฉ 1: ูุชุญ Developer Tools

1. ุงูุชุญ ุตูุญุฉ ุงููุญุงุฏุซุงุช: `http://localhost:8000/agent/conversations/`
2. ุงุถุบุท **F12** ููุชุญ Developer Tools
3. ุงุฐูุจ ุฅูู ุชุจููุจ **Console**

### ุงูุฎุทูุฉ 2: ุงุฎุชุจุงุฑ "ุฃุฎุฐ ุงุณุชุฑุงุญุฉ"

1. ุงุถุบุท ุนูู ุฒุฑ **"ุฃุฎุฐ ุงุณุชุฑุงุญุฉ"**
2. ุฑุงูุจ ุงูุฑุณุงุฆู ูู Console:
   ```
   Attempting to take break...
   Take break response status: 200
   Take break response data: {success: true, ...}
   updateBreakUI called with isOnBreak: true
   Setting UI to: ON BREAK
   Agent break status: true
   ```

### ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ "ุงูุนูุฏุฉ ููุนูู"

1. ุงุถุบุท ุนูู ุฒุฑ **"ุงูุนูุฏุฉ ููุนูู"**
2. ุฑุงูุจ ุงูุฑุณุงุฆู ูู Console:
   ```
   Attempting to end break...
   End break response status: ???
   End break error from server: ???
   ```

### ุงูุฎุทูุฉ 4: ุชุญุฏูุฏ ููุน ุงูุฎุทุฃ

ุงูุธุฑ ุฅูู ุฑุณุงูุฉ ุงูุฎุทุฃ ูู Console:

#### โ ุงูุญุงูุฉ 1: "ุงูููุธู ููุณ ูู ุงุณุชุฑุงุญุฉ"
```
End break error from server: ุงูููุธู ููุณ ูู ุงุณุชุฑุงุญุฉ
```

**ุงูุณุจุจ:** ุนุฏู ุชุฒุงูู ุจูู Frontend ู Backend

**ุงูุญู:** ุงูุธุฑ ุงููุณู "ุฅุตูุงุญ ุนุฏู ุงูุชุฒุงูู" ุฃุฏูุงู

---

#### โ ุงูุญุงูุฉ 2: "ุบูุฑ ูุตุฑุญ ูู ุจูุฐุง ุงูุฅุฌุฑุงุก"
```
End break error from server: ุบูุฑ ูุตุฑุญ ูู ุจูุฐุง ุงูุฅุฌุฑุงุก
```

**ุงูุณุจุจ:** ูุดููุฉ ูู ุงูุตูุงุญูุงุช

**ุงูุญู:** ุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ูู ููุณู ุงูููุธู

---

#### โ ุงูุญุงูุฉ 3: "ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูููุธู"
```
End break error from server: ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูููุธู
```

**ุงูุณุจุจ:** ID ุงูููุธู ุบูุฑ ุตุญูุญ

**ุงูุญู:** ุชุญูู ูู `{{ request.user.agent.id }}` ูู ุงูุตูุญุฉ

---

#### โ ุงูุญุงูุฉ 4: ุฎุทุฃ ูู ุงูุฎุงุฏู (Status: 500)
```
End break error from server: ุญุฏุซ ุฎุทุฃ ูู ุงูุฎุงุฏู (Status: 500)
```

**ุงูุณุจุจ:** ุฎุทุฃ ูู Backend

**ุงูุญู:** ุงูุธุฑ ุฅูู Django logs

---

## ๐ง ุงูุญููู

### ุงูุญู 1: ุฅุตูุงุญ ุนุฏู ุงูุชุฒุงูู

ุฅุฐุง ูุงูุช ุงููุดููุฉ "ุงูููุธู ููุณ ูู ุงุณุชุฑุงุญุฉ"ุ ูุฏ ูููู ููุงู ุนุฏู ุชุฒุงูู ุจูู Frontend ู Backend.

#### ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู ุฃุฏุงุฉ ุงูุงุฎุชุจุงุฑ

```bash
cd System
python test_break_state.py
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
๐ค ุงูููุธู: your_username
   - ุงูุญุงูุฉ (status): on_break
   - ูู ุงุณุชุฑุงุญุฉ (is_on_break): True
   - ููุช ุจุฏุก ุงูุงุณุชุฑุงุญุฉ: 2024-01-10 10:30:00
```

**ุฅุฐุง ูุงูุช ุงููุชูุฌุฉ:**
```
   - ูู ุงุณุชุฑุงุญุฉ (is_on_break): False
```

**ูุนูู ุฐูู:** Backend ูุนุชูุฏ ุฃูู ูุณุช ูู ุงุณุชุฑุงุญุฉุ ููู Frontend ูุธูุฑ ุฒุฑ "ุงูุนูุฏุฉ ููุนูู"

---

#### ุงูุทุฑููุฉ 2: ุฅุตูุงุญ ุงูุญุงูุงุช ุบูุฑ ุงููุชุณูุฉ

```bash
cd System
python test_break_state.py --fix
```

ูุฐุง ุงูุฃูุฑ ุณูุตูุญ:
- โ ููุธููู ูุฏููู `is_on_break=False` ููู `break_started_at` ููุฌูุฏ
- โ ููุธููู ูุฏููู `is_on_break=True` ููู `status != 'on_break'`
- โ ููุธููู ูุฏููู `is_on_break=True` ููู `break_started_at` ุบูุฑ ููุฌูุฏ

---

#### ุงูุทุฑููุฉ 3: ุฅุนุงุฏุฉ ุชุนููู ุฌููุน ุงูุงุณุชุฑุงุญุงุช

```bash
cd System
python test_break_state.py --reset
```

ูุฐุง ุงูุฃูุฑ ุณูุนูุฏ ุชุนููู ุฌููุน ุงูููุธููู ุฅูู ุญุงูุฉ "ูุนูู"

---

### ุงูุญู 2: ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

ุฅุฐุง ูุงูุช ุงููุดููุฉ "ุบูุฑ ูุตุฑุญ ูู ุจูุฐุง ุงูุฅุฌุฑุงุก":

1. ุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ุงูุญุงูู ูู ููุธู:
   ```python
   # ูู Django shell
   python manage.py shell
   >>> from conversations.models import User
   >>> user = User.objects.get(username='your_username')
   >>> user.role
   'agent'  # โ ูุฌุจ ุฃู ูููู 'agent'
   >>> user.agent
   <Agent: ...>  # โ ูุฌุจ ุฃู ูููู ููุฌูุฏ
   ```

2. ุชุญูู ูู ุฃู ID ุงูููุธู ุตุญูุญ:
   - ุงูุชุญ ุตูุญุฉ ุงููุญุงุฏุซุงุช
   - ุงุถุบุท F12 โ Console
   - ุงูุชุจ: `console.log('{{ request.user.agent.id }}')`
   - ูุฌุจ ุฃู ูุทุงุจู ID ุงูููุธู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

### ุงูุญู 3: ุงูุชุญูู ูู Django Logs

ุฅุฐุง ูุงู ุงูุฎุทุฃ 500 (Internal Server Error):

1. ุงูุชุญ terminal ุญูุซ ูุนูู Django server
2. ุงุจุญุซ ุนู ุฑุณุงุฆู ุงูุฎุทุฃ:
   ```
   ERROR ... Exception in end_break: ...
   ```
3. ุฃุฑุณู ุฑุณุงูุฉ ุงูุฎุทุฃ ุงููุงููุฉ ูููุทูุฑ

---

## ๐งช ุงุฎุชุจุงุฑ ุดุงูู

### ุงูุณููุงุฑูู ุงููุงูู:

1. **ุงูุชุญ ุตูุญุฉ ุงููุญุงุฏุซุงุช**
   ```
   http://localhost:8000/agent/conversations/
   ```

2. **ุงูุชุญ Console (F12)**

3. **ุชุญูู ูู ุงูุญุงูุฉ ุงูุฃูููุฉ**
   ```javascript
   // ูู Console
   // ูุฌุจ ุฃู ุชุฑู:
   Agent break status: false
   Agent status: available
   updateBreakUI called with isOnBreak: false
   Setting UI to: WORKING
   ```

4. **ุงุถุบุท "ุฃุฎุฐ ุงุณุชุฑุงุญุฉ"**
   ```javascript
   // ูุฌุจ ุฃู ุชุฑู:
   Attempting to take break...
   Take break response status: 200
   Take break response data: {success: true, ...}
   updateBreakUI called with isOnBreak: true
   Setting UI to: ON BREAK
   ```

5. **ุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
   ```bash
   python test_break_state.py
   # ูุฌุจ ุฃู ุชุฑู:
   # ูู ุงุณุชุฑุงุญุฉ (is_on_break): True
   ```

6. **ุงุถุบุท "ุงูุนูุฏุฉ ููุนูู"**
   ```javascript
   // ูุฌุจ ุฃู ุชุฑู:
   Attempting to end break...
   End break response status: 200
   End break response data: {success: true, ...}
   updateBreakUI called with isOnBreak: false
   Setting UI to: WORKING
   ```

7. **ุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฑุฉ ุฃุฎุฑู**
   ```bash
   python test_break_state.py
   # ูุฌุจ ุฃู ุชุฑู:
   # ูู ุงุณุชุฑุงุญุฉ (is_on_break): False
   ```

---

## ๐ ุฌุฏูู ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

| ุฑุณุงูุฉ ุงูุฎุทุฃ | ุงูุณุจุจ ุงููุญุชูู | ุงูุญู |
|------------|---------------|------|
| "ุงูููุธู ููุณ ูู ุงุณุชุฑุงุญุฉ" | ุนุฏู ุชุฒุงูู Frontend/Backend | `python test_break_state.py --fix` |
| "ุบูุฑ ูุตุฑุญ ูู ุจูุฐุง ุงูุฅุฌุฑุงุก" | ูุดููุฉ ูู ุงูุตูุงุญูุงุช | ุชุญูู ูู `user.role` ู `user.agent` |
| "ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูููุธู" | ID ุฎุงุทุฆ | ุชุญูู ูู `{{ request.user.agent.id }}` |
| "ุญุฏุซ ุฎุทุฃ ูู ุงูุฎุงุฏู" | ุฎุทุฃ ูู Backend | ุงูุธุฑ Django logs |
| "Cannot read properties of null" | ุนูุงุตุฑ UI ููููุฏุฉ | ุชู ุฅุตูุงุญู ูู ุงูุชุญุฏูุซ ุงูุฃุฎูุฑ |

---

## ๐ ูุนูููุงุช ุฅุถุงููุฉ ููุชุดุฎูุต

### ุชุญูู ูู ุญุงูุฉ ุงูููุธู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```bash
python manage.py shell
```

```python
from conversations.models import Agent, User

# ุงุญุตู ุนูู ุงูููุธู
user = User.objects.get(username='your_username')
agent = user.agent

# ุงุทุจุน ุงูุญุงูุฉ
print(f"is_on_break: {agent.is_on_break}")
print(f"status: {agent.status}")
print(f"break_started_at: {agent.break_started_at}")

# ุฅุฐุง ูุงูุช ุงูุญุงูุฉ ุฎุงุทุฆุฉุ ุฃุตูุญูุง:
if agent.is_on_break:
    agent.is_on_break = False
    agent.break_started_at = None
    agent.status = 'available'
    agent.save()
    print("โ ุชู ุฅุตูุงุญ ุงูุญุงูุฉ")
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชุฒุงูู ุงูุชููุงุฆู**: ูุชู ูุญุต ุญุงูุฉ ุงูุงุณุชุฑุงุญุฉ ูู 30 ุซุงููุฉ ุชููุงุฆูุงู
2. **ุชุญุฏูุซ ุงูุตูุญุฉ**: ุฅุฐุง ุญุฏุซ ุฎุทุฃุ ุฌุฑุจ ุชุญุฏูุซ ุงูุตูุญุฉ (F5)
3. **ูุณุญ Cache**: ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุงูุณุญ cache ุงููุชุตูุญ (Ctrl+Shift+Delete)
4. **Django Logs**: ุฏุงุฆูุงู ุฑุงูุจ Django logs ููุญุตูู ุนูู ูุนูููุงุช ููุตูุฉ

---

## โ ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ

ุชู ุฅุถุงูุฉ logging ุดุงูู ูู:

1. โ `checkBreakStatus()` - ูุณุฌู ุญุงูุฉ ุงูููุธู
2. โ `updateBreakUI()` - ูุณุฌู ุชุญุฏูุซุงุช UI
3. โ `takeBreak()` - ูุณุฌู ุนูููุฉ ุจุฏุก ุงูุงุณุชุฑุงุญุฉ
4. โ `endBreak()` - ูุณุฌู ุนูููุฉ ุฅููุงุก ุงูุงุณุชุฑุงุญุฉ

ุงูุขู ููููู ุฑุคูุฉ ูู ุฎุทูุฉ ูู Console ููุชุดุฎูุต ุงูุฏููู.

---

**๐ฏ ุงูุฎุทูุฉ ุงูุชุงููุฉ:**

1. ุงูุชุญ ุตูุญุฉ ุงููุญุงุฏุซุงุช
2. ุงูุชุญ Console (F12)
3. ุฌุฑุจ "ุฃุฎุฐ ุงุณุชุฑุงุญุฉ" ุซู "ุงูุนูุฏุฉ ููุนูู"
4. ุงูุณุฎ ุฌููุน ุงูุฑุณุงุฆู ูู Console
5. ุฃุฑุณููุง ูููุทูุฑ ูุชุญููููุง

---

**ุชู ุจูุฌุงุญ! ๐**

